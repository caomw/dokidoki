\chapter{System Architecture}
\section{System}

System class is responsible for arranging every thing inside dokidoki system. It contains a world which has lots of characters and one player. These characters take behaviors to interact with each other to progress the game. Behavior is a kind of action. Action is the minimum unit of things that happens in the AVG game, such as the position changing of a character, a sentence the character spoke. Effect is another kind of action such as the start of playing a sound, the start of the video and so on.

\section{Script}

Scripts class is responsible to recognize the script written by AVG game developer, and then compile it into action sequences for System to conduct.

\subsection{Example}

Here give an example.

\begin{lstlisting}
world
	video src=video0;
	bgm src=bgm0 mode=loop;
	background src=background0 transition=instant;
	weather type=snow level=0.2;
	>??????????
	>????????????
	sound src=sound0;
	>????????


dokiChan
	role type=character name = "??"; 
	move position=center transition=instant; 
	posture src=posture0; 
	voice src=voice001 >>??????
	voice src=voice002 >>???????
	voice src=voice003 >>?????????

["????????????????"(option011, sample1) | "???????????????"(option012, sample1)] 


<option011>


world
	>>?????????

I
	role type=player;
	voice >>??????????????

dokiChan
	move position=(0.45, 0.0, 0.0) transition=instant; 
	voice src=voice004 >>??????????

I
	voice >>????????

(sample2)

<option012>
I
	>>????????????????????? 

world
	>>??????????????????? 
	weather type=sunny; 
	>>????????

(sample3)
\end{lstlisting}

\subsection{Grammar}

\begin{center}
\begin{longtable}{| C{1cm} | L{8cm} | L{3cm} |}
  \hline
     & Example & Description \\ \hline
  Doki &
  &
  Mostly, one script file \\ \hline
  Flag & 
  \begin{lstlisting}
  [????????????????(option011, sample1) | ???????????????(option012, sample1)]
  \end{lstlisting} & 
  Flag with options to choose \\ \hline
  Option & 
  \begin{lstlisting}
  <option011>
  \end{lstlisting} &  
  Option that Flags should jump here when this option is chosen \\ \hline
  Lock &
  \begin{lstlisting}
  { xxx }
  \end{lstlisting} & 
  For some performance, disable players? operations \\ \hline
  Block &
  \begin{lstlisting}
  world	video src=video0;	bgm src=bgm0 mode=loop;	backgound src=background0 transition=instant;	weather type=snow level=0.2;	??????????>	????????????>	sound src=sound0;	????????>
  \end{lstlisting} & 
  One block of script code, start with one focused Object, maybe world or characterId (here means those lines code would focus on the world) \\ \hline
  Action &
  \begin{lstlisting}
  bgm src=bgm0 mode=loop
  \end{lstlisting} & 
  Action, focused on current \\ \hline
  Tag &
  \begin{lstlisting}
  bgm
  \end{lstlisting} & 
  Action tags \\ \hline
  Key=Value &
  \begin{lstlisting}
  src=bgm0 mode=loop
  \end{lstlisting} & 
  Parameters for current action \\ \hline
  Key &
  \begin{lstlisting}
  src	
  \end{lstlisting} & 
  Attributes key \\ \hline
  Value &
  \begin{lstlisting}
  bgm0
  \end{lstlisting} & 
  Attributes value\\ \hline
  Text &
  \begin{lstlisting}
  ??????????
  \end{lstlisting} & 
  \\ \hline
\end{longtable}
\end{center}

vfdsg
